<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Jaffar's Creations</title>
        <link rel="stylesheet" href="index.css">
    </head>
    <body>
        <nav class="nav-bar">
            <div class="nav-item nav-logo">
                <img src="./assets/game.svg" class="icon" />
            </div>
            <div class="nav-item"><a href="#">Projects</a></div>
            <div class="nav-item"><a href="#">Something else</a></div>
        </nav>

        <div class="main-contents">

            <div class="bio">
                <h5>Hi, I'm Jaffar Totanji</h5>
                <div>I've never written a bio I'll think about one later</div>
            </div>

            <div class="projects">
                <ul>
                    <li>Project_1</li>
                    <li>Project_2</li>
                    <li>Project_3</li>
                </ul>
            </div>

            <div class="contacts">
                <a href="https://github.com/KuronoSangatsu7" target="_blank" id="gh-link">
                    <img src="./assets/github.png" class="contact-icon" />
                </a>

                <a href="https://www.linkedin.com/in/jaffar-totanji/" target="_blank" id="li-link">
                    <img src="./assets/linkedin.png" class="contact-icon" />
                </a>
                
                <a href="https://t.me/KuroHata7" target="_blank" id="tg-link">
                    <img src="./assets/telegram.png" class="contact-icon" />
                </a>

                <a href="mailto:jaafarti@gmail.com" target="_blank" id="email">
                    <img src="./assets/mail.png" class="contact-icon" />
                </a>

            </div>

            <div class="hw2">
                <button id="fetch-id">Comics?</button>
                <div id="comic-title"></div>
                <img id="comic" />
                <div id="upload-date"></div>
            </div>

        </div>

        <script>
            const fetchBtn = document.getElementById('fetch-id')
            const comicImg = document.getElementById('comic')
            const dateDiv = document.getElementById('upload-date')
            const titleDiv = document.getElementById('comic-title')

            const fetchComicID = (email) => {
                const paramsObj = {email: email}
                const params = new URLSearchParams(paramsObj)

                return fetch('https://fwd.innopolis.app/api/hw2?' + params.toString())
                    .then(r => r.json())
            }
            
            const fetchComic = (id) => {
                const paramsObj = {num: id}
                const params = new URLSearchParams(paramsObj)

                return fetch('https://getxkcd.vercel.app/api/comic?' + params.toString())
                    .then(r => r.json())
            }

            const setAttributes = (element, atts) => {
                for (let key in atts)
                    element.setAttribute(key, atts[key])
            }

            const handleComicObj = (comicObj) => {
                // Image
                const imgSrc = comicObj['img']

                // Title
                const imgTitle = comicObj['title']

                // Alt text
                const imgAlt = comicObj['alt']

                // Date
                const day = comicObj['day']
                const month = comicObj['month']
                const year = comicObj['year']

                let imgDate = new Date(year, month, day)

                imgDate = imgDate.toLocaleDateString('en-GB')

                atts = {src: imgSrc,
                        title: imgTitle,
                        alt: imgAlt,
                        height: 300,
                        width: 400
                    }

                setAttributes(comicImg, atts)
                dateDiv.innerText = "Upload Date: " + imgDate
                titleDiv.innerText = imgTitle
            }

            fetchBtn.addEventListener('click', async () => {
                const comicID = await fetchComicID('j.totanji@innopolis.university')

                const comicObj = await fetchComic(comicID)

                handleComicObj(comicObj)

            })

        </script>

    </body>
</html>